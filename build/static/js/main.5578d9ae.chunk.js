(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{41:function(e,t,a){e.exports=a(89)},46:function(e,t,a){},89:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(35),o=a.n(c),s=(a(46),a(5)),l=a(12),i=a(17),u=a(10),m=a(2);var d=function(e,t,a){var n=r.a.useState(e),c=Object(m.a)(n,2),o=c[0],s=c[1],l=r.a.useState({}),d=Object(m.a)(l,2),p=d[0],h=d[1],f=r.a.useState(!1),v=Object(m.a)(f,2),b=v[0],E=v[1];return r.a.useEffect(function(){b&&(0===Object.keys(p).length?(console.log("Authenticate user"),a(),E(!1)):E(!1))},[p]),{handleChange:function(e){e.persist(),s(function(t){return Object(u.a)({},t,Object(i.a)({},e.target.name,e.target.value))})},handleSubmit:function(e){e.preventDefault();var a=t(o);h(a),E(!0),console.log({values:o})},handleBlur:function(){var e=t(o);h(e)},values:o,errors:p,isSubmitting:b}};function p(e){var t={};return e.description?e.description.length<6&&(t.description="Description must be atleast 6 characters"):t.description="description reqd.",e.url?/^(ftp|http|https):\/\/[^ "]+$/.test(e.url)||(t.url="URL must be a valid one"):t.url="URL reqd.",t}var h=a(4),f=a.n(h),v=a(11),b=a(36),E=a(37),g=a(20),w=a.n(g),k=(a(49),a(51),{apiKey:"AIzaSyBOigG5XyQbqyyfFaPnD9ECTVcqj6zDjKM",authDomain:"hacker-news-hooks-e1f82.firebaseapp.com",databaseURL:"https://hacker-news-hooks-e1f82.firebaseio.com",projectId:"hacker-news-hooks-e1f82",storageBucket:"hacker-news-hooks-e1f82.appspot.com",messagingSenderId:"584557338177",appId:"1:584557338177:web:be291cd0584068b5b5f0c0",measurementId:"G-GEW45EB0HR"}),y=new(function(){function e(){Object(b.a)(this,e),w.a.initializeApp(k),this.auth=w.a.auth(),this.db=w.a.firestore()}return Object(E.a)(e,[{key:"register",value:function(){var e=Object(v.a)(f.a.mark(function e(t,a,n){var r;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.auth.createUserWithEmailAndPassword(a,n);case 2:return r=e.sent,e.next=5,r.user.updateProfile({displayName:t});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)}));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"login",value:function(){var e=Object(v.a)(f.a.mark(function e(t,a){return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.auth.signInWithEmailAndPassword(t,a);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=Object(v.a)(f.a.mark(function e(){return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.auth.signOut();case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"resetPassword",value:function(){var e=Object(v.a)(f.a.mark(function e(t){return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.auth.sendPasswordResetEmail(t);case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}()),N=r.a.createContext(null),x=y,C={description:"",url:""};var j=function(e){var t=r.a.useContext(N),a=t.firebase,n=t.user,c=d(C,p,function(){if(n){var t=l.url,r=l.description,c={url:t,description:r,postedBy:{id:n.uid,name:n.displayName},voteCount:0,votes:[],comments:[],created:Date.now()};a.db.collection("links").add(c),e.history.push("/")}else e.history.push("/login")}),o=c.handleSubmit,s=c.handleChange,l=c.values,i=c.errors;return r.a.createElement("div",null,r.a.createElement("form",{onSubmit:o,className:"flex flex-column mt3"},r.a.createElement("input",{onChange:s,name:"description",placeholder:"Description",type:"text",value:l.description,className:i.description&&"error-input"}),i.description&&r.a.createElement("p",{className:"error-text"}," ",i.description),r.a.createElement("input",{onChange:s,name:"url",placeholder:"URL",type:"url",value:l.url}),i.url&&r.a.createElement("p",{className:"error-text"}," ",i.url),r.a.createElement("button",{type:"submit",className:"button"},"Submit")))};function O(e){var t={};return e.email?/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i.test(e.email)||(t.email="Invalid email"):t.email="Email reqd.",e.password?e.password.length<6&&(t.password="Password must be atleast 6 chars"):t.password="Password reqd.",t}var S={name:"",email:"",password:""};var B=function(e){var t=d(S,O,function(){return N.apply(this,arguments)}),a=t.handleChange,c=t.handleSubmit,o=t.handleBlur,l=t.values,i=t.errors,u=t.isSubmitting,p=Object(n.useState)(!0),h=Object(m.a)(p,2),b=h[0],E=h[1],g=Object(n.useState)(null),w=Object(m.a)(g,2),k=w[0],y=w[1];function N(){return(N=Object(v.a)(f.a.mark(function t(){var a,n,r;return f.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=l.name,n=l.email,r=l.password,t.prev=1,!b){t.next=7;break}return t.next=5,x.login(n,r);case 5:t.next=9;break;case 7:return t.next=9,x.register(a,n,r);case 9:e.history.push("/"),t.next=16;break;case 12:t.prev=12,t.t0=t.catch(1),console.log("Auth error>>>",t.t0),y(t.t0.message);case 16:case"end":return t.stop()}},t,null,[[1,12]])}))).apply(this,arguments)}return r.a.createElement("div",null,r.a.createElement("h2",{className:"mv3"}," ",b?"Login":"Create Account"," "),r.a.createElement("form",{onSubmit:c,className:"flex flex-column"},!b&&r.a.createElement("input",{name:"name",type:"text",onChange:a,placeholder:"Your name",value:l.name}),r.a.createElement("input",{name:"email",onChange:a,onBlur:o,type:"email",className:i.email&&"error-input",placeholder:"Your email",value:l.email}),i.email&&r.a.createElement("p",{className:"error-text"}," ",i.email," "),r.a.createElement("input",{name:"password",onChange:a,onBlur:o,type:"password",className:i.password&&"error-input",placeholder:"Your password",value:l.password}),i.password&&r.a.createElement("p",{className:"error-text"}," ",i.password," "),k&&r.a.createElement("p",{className:"error-text"}," ",k," "),r.a.createElement("div",{className:"flex mt3"},r.a.createElement("button",{disabled:u,style:{background:u?"grey":"orange"},type:"submit",className:"button pointer mr2"},"Submit"),r.a.createElement("button",{type:"button",onClick:function(){return E(function(e){return!e})},className:"button pointer"},b?"Create an account":"already have an account?"))),r.a.createElement("div",{className:"forgot-password"},r.a.createElement(s.b,{to:"/forgot"}," Reset password? ")))};var P=function(){var e=r.a.useContext(N).firebase,t=r.a.useState(""),a=Object(m.a)(t,2),n=a[0],c=a[1],o=r.a.useState(!1),s=Object(m.a)(o,2),l=s[0],i=s[1],u=r.a.useState(null),d=Object(m.a)(u,2),p=d[0],h=d[1];function b(){return(b=Object(v.a)(f.a.mark(function t(){return f.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.resetPassword(n);case 3:i(!0),h(null),t.next=12;break;case 7:t.prev=7,t.t0=t.catch(0),console.error(t.t0),h(t.t0.message),i(!1);case 12:case"end":return t.stop()}},t,null,[[0,7]])}))).apply(this,arguments)}return r.a.createElement("div",null,r.a.createElement("input",{onChange:function(e){return c(e.target.value)},className:"input",placeholder:"Provide your email",type:"email"}),r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return function(){return b.apply(this,arguments)}(n)},className:"button"},"Reset password")),l&&r.a.createElement("p",null," Password reset mail on your way! "),p&&r.a.createElement("p",{className:"error-text"}," ",p," "))},A=a(19);var D=a(18),I=a.n(D);var L=Object(l.g)(function(e){var t=e.link,a=e.index,n=e.showCount,c=e.history,o=r.a.useContext(N),l=o.firebase,i=o.user,u=i&&i.uid===t.postedBy.id;return r.a.createElement("div",{className:"flex items-start mt2"},r.a.createElement("div",{className:"flex items-center"},n&&r.a.createElement("span",{className:"gray"}," ",a),r.a.createElement("div",{onClick:function(){if(i){var e=l.db.collection("links").doc(t.id);e.get().then(function(t){if(t.exists){var a=t.data().votes,n={votedBy:{id:i.uid,name:i.displayName}},r=[].concat(Object(A.a)(a),[n]),c=r.length;e.update({votes:r,voteCount:c})}})}else c.push("/login")},className:"vote-button"},"\u25b2")),r.a.createElement("div",{className:"ml1"},r.a.createElement("div",null,r.a.createElement("a",{className:"black no-underline",href:t.url},t.description),r.a.createElement("span",{className:"link"}," (",t.url.replace(/^https?:\/\//i,""),")")),r.a.createElement("div",{className:"f6 lh-copy gray"},t.voteCount," votes by ",t.postedBy.name,I()(t.created)," | ",r.a.createElement(s.b,{to:"/link/".concat(t.id)},t.comments.length>0?"".concat(t.comments.length," comments"):"discuss"),u&&r.a.createElement(r.a.Fragment,null," | ",r.a.createElement("span",{onClick:function(){l.db.collection("links").doc(t.id).delete().then(function(){console.log("Document deleted successfully!")}).catch(function(e){console.error("Deletion aborted")})},className:"delete-button"}," ","delete")))))});var R=function(){var e=r.a.useState(""),t=Object(m.a)(e,2),a=t[0],n=t[1],c=r.a.useState([]),o=Object(m.a)(c,2),s=o[0],l=o[1],i=r.a.useContext(N),d=i.firebase,p=(i.user,r.a.useState([])),h=Object(m.a)(p,2),f=h[0],v=h[1];return r.a.useEffect(function(){d.db.collection("links").get().then(function(e){var t=e.docs.map(function(e){return Object(u.a)({id:e.id},e.data())});v(t)})},[]),r.a.createElement("div",null,r.a.createElement("form",{onSubmit:function(e){e.preventDefault();var t=a.toLowerCase(),n=f.filter(function(e){return e.description.toLowerCase().includes(t)||e.url.toLowerCase().includes(t)||e.postedBy.name.toLowerCase().includes(t)});l(n)}},r.a.createElement("div",null,"Search ",r.a.createElement("input",{onChange:function(e){return n(e.target.value)}}),r.a.createElement("button",null," OK "))),s.map(function(e,t){return r.a.createElement(L,{key:e.id,showCount:!1,link:e,index:t})}))},q=a(40),U=a.n(q);var W=function(e){var t=r.a.useContext(N).firebase,a=r.a.useState([]),n=Object(m.a)(a,2),c=n[0],o=n[1],s=r.a.useState(null),l=Object(m.a)(s,2),i=l[0],d=l[1],p=e.location.pathname.includes("new"),h=e.location.pathname.includes("top"),f=+e.match.params.page;function v(e){var t=e.docs.map(function(e){return Object(u.a)({id:e.id},e.data())}),a=t[t.length-1];o(t),d(a)}r.a.useEffect(function(){var e=function(){var e=Boolean(i);if(h)return t.db.collection("links").orderBy("voteCount","desc").limit(2).onSnapshot(v);if(1===f)return t.db.collection("links").orderBy("created","desc").limit(2).onSnapshot(v);if(e)return t.db.collection("links").orderBy("created","desc").limit(2).startAfter(i.created).onSnapshot(v);var a=2*f-2;return U.a.get("https://us-central1-hacker-news-hooks-e1f82.cloudfunctions.net/linksPagination?offset=".concat(a)).then(function(e){var t=e.data,a=t[t.length-1];o(t),d(a)}),function(){}}();return function(){return e()}},[h,f]);var b=f?2*(f-1)+1:0;return r.a.createElement("div",null,c.map(function(e,t){return r.a.createElement(L,{key:e.id,showCount:!0,link:e,index:t+b})}),p&&r.a.createElement("div",{className:"pagination"},r.a.createElement("div",{onClick:function(){f>1&&e.history.push("/new/".concat(f-1))},className:"pointer mr2"},"Previous"),r.a.createElement("div",{onClick:function(){f<=c.length/2&&e.history.push("/new/".concat(f+1))},className:"pointer"},"Next")))};var F=function(e){var t=r.a.useContext(N),a=t.firebase,n=t.user,c=r.a.useState(null),o=Object(m.a)(c,2),s=o[0],l=o[1],i=r.a.useState(""),d=Object(m.a)(i,2),p=d[0],h=d[1],f=e.match.params.linkId,v=a.db.collection("links").doc(f);return r.a.useEffect(function(){v.get().then(function(e){l(Object(u.a)({},e.data(),{id:e.id}))})},[]),s?r.a.createElement("div",null,r.a.createElement(L,{showCount:!1,link:s}),r.a.createElement("textarea",{onChange:function(e){return h(e.target.value)},value:p,cols:"60",rows:"6"}),r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){n?v.get().then(function(e){if(e.exists){var t=e.data().comments,a={postedBy:{id:n.uid,name:n.displayName},created:Date.now(),text:p},r=[].concat(Object(A.a)(t),[a]);v.update({comments:r}),l(function(e){return Object(u.a)({},e,{comments:r})}),h("")}}):e.history.push("/login")},className:"button"},"Add comment")),s.comments.map(function(e,t){return r.a.createElement("div",{key:t},r.a.createElement("p",{className:"comment-author"},e.postedBy.name," | ",I()(e.created)),r.a.createElement("p",null," ",e.text," "))})):r.a.createElement("div",null," Loading..")};var z=function(){var e=r.a.useContext(N),t=e.user,a=e.firebase;return r.a.createElement("div",{className:"header"},r.a.createElement("div",{className:"flex"},r.a.createElement("img",{className:"logo",src:"/logo.png",alt:"Hooks news logo"}),r.a.createElement(s.c,{to:"/",className:"header-title"},"Hooks News"),r.a.createElement(s.c,{to:"/",className:"header-link"},"new"),r.a.createElement("div",{className:"divider"},"| "),r.a.createElement(s.c,{to:"/top",className:"header-link"},"top"),r.a.createElement("div",{className:"divider"},"| "),r.a.createElement(s.c,{to:"/search",className:"header-link"},"search"),t&&r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"divider"},"| "),r.a.createElement(s.c,{to:"/create",className:"header-link"},"submit"))),r.a.createElement("div",{className:"flex"},t?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"header-name"}," ",t.displayName," "),r.a.createElement("div",{className:"divider"},"|"),r.a.createElement("div",{onClick:function(){return a.logout()},className:"header-button"},"logout")):r.a.createElement(s.c,{to:"/login",className:"header-link"},"login")))};var G=function(){var e=r.a.useState(null),t=Object(m.a)(e,2),a=t[0],n=t[1];return r.a.useEffect(function(){var e=x.auth.onAuthStateChanged(function(e){n(e||null)});return function(){return e()}},[]),a};var H=function(){var e=G();return r.a.createElement(s.a,null,r.a.createElement(N.Provider,{value:{user:e,firebase:x}},r.a.createElement("div",{className:"app-container"},r.a.createElement(z,null),r.a.createElement("div",{className:"route-container"},r.a.createElement(l.d,null,r.a.createElement(l.b,{exact:!0,path:"/",render:function(){return r.a.createElement(l.a,{to:"/new/1"})}}),r.a.createElement(l.b,{path:"/create",component:j}),r.a.createElement(l.b,{path:"/login",component:B}),r.a.createElement(l.b,{path:"/forgot",component:P}),r.a.createElement(l.b,{path:"/search",component:R}),r.a.createElement(l.b,{path:"/top",component:W}),r.a.createElement(l.b,{path:"/new/:page",component:W}),r.a.createElement(l.b,{path:"/link/:linkId",component:F}))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(H,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[41,1,2]]]);
//# sourceMappingURL=main.5578d9ae.chunk.js.map